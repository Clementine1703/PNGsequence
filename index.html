<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Main</title>
	<style>
		*{
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body{
			width: 100%;
			min-height: 100vh;
		}

		.preloader{
			display: flex;
			justify-content: center;
			align-items: center;
			position: fixed;
			width: 100%;
			height: 100vh;
			z-index: 100;
			background-color: white;
		}

		.background{
			position: fixed;
			width: 100%;
			height: 100vh;
		}

		.container{
			width: 100%;
			height: 450vh;
		}
	</style>
</head>
<body>
	<div class="preloader">
		<p style="font-size: 30px;">Загрузка...</p>
	</div>

	<div class="background">
		<canvas id="bgAnimation" ></canvas>
	</div>

	<div class="container">

	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	
	<script type="text/javascript">
		$(window).on('load', function() {
			function deletePreloader(){
				var preloader = document.querySelector(".preloader");
				preloader.parentNode.removeChild(preloader);
			}

			deletePreloader();
		})

		document.addEventListener('DOMContentLoaded', ()=>{

			

			function sleep(milliseconds) {
  			const date = Date.now();
  			let currentDate = null;
  			do {
    		currentDate = Date.now();
  			} while (currentDate - date < milliseconds);
			}




			$.fn.preload = function() {
    			this.each(function(){
        		$('<img/>')[0].src = this;
				preloadImagesCounter++;
    			});
				}

			function preload() {
				const imageURL = 'bg_images/babina30fps_jpeg_v3<number_of_image>.jpg';
				let preload_list = [];
    			for (let i = 0; i < countOfImages; i++){
					let replace_value = i;
					let replace_value_str = replace_value.toString();
					for (let k = 0; k < countOfImages.toString().length - replace_value.toString().length; k++){
					replace_value_str = '0' + replace_value_str;
					console.log(replace_value_str);
					}
					let preload_src = imageURL.replace('<number_of_image>', replace_value_str);
					preload_list.push(preload_src);
				}
				$(preload_list).preload();
			}

			function sprite (options) {
				
				var that = {};
							  
				that.context = options.context;
				that.width = options.width;
				that.height = options.height;
				that.image = options.image;
		  
				
				that.render = function () {

				that.context.clearRect(0, 0, canvas.width, canvas.height);

				// Draw the animation
				that.context.drawImage(
					that.image,
					0,
					0,
					that.width,
					that.height,
					0,
					0,
					that.width,
					that.height);
				};
				
				return that;
			}





			preload();


			// deletePreloader();

			var preloadImagesCounter = 0;
			var countOfImages = 179;

			var bgImage = new Image();
			bgImage.src = "bg_images/babina30fps_jpeg_v3000.jpg";

			var canvas = document.getElementById("bgAnimation");
			canvas.width = innerWidth;
			canvas.height = innerHeight;

			var bg = sprite({
    		context: canvas.getContext("2d"),
    		width: 1920,
    		height: 1080,
    		image: bgImage
			});


















			bgImage.onload = ()=>{
				bg.context.scale(window.innerWidth/bgImage.width, window.innerHeight/bgImage.height);
				bg.render();
				
			}

			var exScrollValue = 0;










			

			window.addEventListener('wheel', ()=>{
				if (exScrollValue != Math.floor(window.scrollY)){
					changeImage();
					exScrollValue = Math.floor(window.scrollY);
				}
			})

			setInterval(()=>{
				if (exScrollValue != Math.floor(window.scrollY)){
					changeImage();
					exScrollValue = Math.floor(window.scrollY);
				}
			}, 50)
			



			function changeImage(){
				let numberOfImage = String(Math.floor(window.scrollY/((document.body.scrollHeight - window.innerHeight)/179)));
				for (let i = 0; i < 3 - numberOfImage.length; i++){
					numberOfImage = '0' + numberOfImage;
				}

				bgImage.src = `bg_images/babina30fps_jpeg_v3${numberOfImage}.jpg`;
				bgImage.onload = ()=>{
				bg.render();
			}
			}


















			


			

		})
	</script>
</body>
</html>